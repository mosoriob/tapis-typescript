# `tapis-typescript`

This project creates autogenerated TypeScript types and fetch bindings for TAPIS v3 from its OpenAPI specifications.

## Directory Structure

### [`tapis-typescript`](./tapis-typescript)

The `@tapis/tapis-typescript` roll up package.

### [`example`](./example)

An example project that uses `@tapis/tapis-typescript` from npm.

### [`tapis-openapi`](./tapis-openapi)

OpenAPI yml files from [https://tapis-project.github.io/live-docs/](https://tapis-project.github.io/live-docs/)

### [`gen`](./gen)

Output directory of `tapis-typescript` npm package

### [`transforms`](./transforms)

Transformation scripts

- [`utils.js`](./transforms/utils.js): Utility functions for working with yml files

### [`transformed_openapi`](./transformed_openapi)

Transformation script output files

### [`./generate.sh`](./generate.sh)

Generation script that accepts the name of the service as a parameter and runs the entire workflow. All files must match the service name. For example, running `./generate.sh systems` will:

- Run [`transforms/systems.js`](./transforms/systems.js), which should read [`tapis_openapi/systems.yml`](./tapis_openapi/systems.yml) and output the transformed results to [`transformed_openapi/systems.yml`](./transformed_openapi/systems.yml)
- Run the `openapi-generator-cli` and pass it [`configs/systems.json`](./configs/systems.json)with an output directory of [`gen/systems`](./gen/systems)

## Building and Testing

The `@tapis/typescript` top level package locally references all of the services in the `./gen` folder. These services must be built, and then the top level package can be built. To do so, do the following:

- `npm run build-services`
- `npm install`
- `npm run build`

Then you can run `npm run test`

## Building and Testing - In Docker

This library contains some dependencies which makes configuring your environment somewhat complicated. To alleviate this, there is a provided Docker environment to work in. 

- `cd <your_path>/tapis-typescript`
- `docker build -t tapis-typescript-environment .`
- `docker run -it -v .:/src --entrypoint=bash tapis-typescript-environment`
- This should mount your host's repo folder to the container's `/src`. Meaning all changes in the container should persists on your host.
- Now you should be able to run npm commands and `./generate.sh` script
- `./generated.sh pods` 

## Brief words on adding a service
To add the Pods service, I was able to:
- Copy `/services/workflows` to `/services/pods` and start changing files within.
- Add my own `spec.yml`
- Change `config.json`
- Run `./generate.sh pods`
- Attempt to parse generation errors and configure `post-gen.js` and `transform.js` to fix any problems. You can also fix problems at the spec level if it's something else.
- Generated library should be in `/gen/pods`